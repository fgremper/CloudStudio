package ch.ethz.fgremper.rtca;

import java.awt.Color;
import java.awt.Container;
import java.awt.Font;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.image.BufferedImage;
import java.io.File;

import javax.imageio.ImageIO;
import javax.swing.BorderFactory;
import javax.swing.DefaultListModel;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JProgressBar;
import javax.swing.JScrollBar;
import javax.swing.JScrollPane;
import javax.swing.border.BevelBorder;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

public class ClientGUI {

	private static final Logger log = LogManager.getLogger(ClientGUI.class);

    public DefaultListModel logModel = new DefaultListModel();
    
    public static void createAndShowGUI() {
    	
        // Create and set up the window (frame)
        JFrame frame = new JFrame("RTCA Client");
        frame.setSize(600, 420);
        frame.setResizable(false);
        Container pane = frame.getContentPane();
        pane.setLayout(null);
        
        // Init log list and scroll pane
        JList logList = new JList(logModel);
        logList.setFont(new Font("Helvetica", Font.PLAIN, 12));
        JScrollPane logScrollPane = new JScrollPane(logList);
        logScrollPane.setBorder(BorderFactory.createLineBorder(Color.GRAY));
        logScrollPane.setBounds(6, 155, 588, 237);
        pane.add(logScrollPane);
        
        // Init traffic light images
        try {
	        BufferedImage trafficImageGreen = ImageIO.read(new File("TrafficGreen.png"));
	        JLabel trafficLabelGreen = new JLabel(new ImageIcon(trafficImageGreen));
	        trafficLabelGreen.setBounds(15, 15, 120, 120);
	        pane.add(trafficLabelGreen);
        }
        catch (Exception e) {
        	log.error("Couldn't load traffic light image.");
        }

        // Init monitoring text
        JLabel monitoringText = new JLabel("Monitoring 4 local repositories.");
        monitoringText.setFont(new Font("Helvetica", Font.PLAIN, 14));
        monitoringText.setBounds(160, 27, 400, 20);
        pane.add(monitoringText);
        
        // Init status caption
        JLabel statusCaption = new JLabel("Status:");
        statusCaption.setFont(new Font("Helvetica", Font.BOLD, 14));
        statusCaption.setBounds(160, 58, 100, 20);
        pane.add(statusCaption);
        
        // Init last update caption
        JLabel lastUpdateCaption = new JLabel("Last update:");
        lastUpdateCaption.setFont(new Font("Helvetica", Font.BOLD, 14));
        lastUpdateCaption.setBounds(160, 78, 100, 20);
        pane.add(lastUpdateCaption);

        // Init next update caption
        JLabel nextUpdateCaption = new JLabel("Next update:");
        nextUpdateCaption.setFont(new Font("Helvetica", Font.BOLD, 14));
        nextUpdateCaption.setBounds(160, 109, 100, 20);
        pane.add(nextUpdateCaption);
        
        // Init status text
        JLabel statusText = new JLabel("Idle");
        statusText.setFont(new Font("Helvetica", Font.PLAIN, 14));
        statusText.setBounds(270, 58, 300, 20);
        pane.add(statusText);
        
        // Init last update text
        JLabel lastUpdateText = new JLabel("49 seconds ago");
        lastUpdateText.setFont(new Font("Helvetica", Font.PLAIN, 14));
        lastUpdateText.setBounds(270, 78, 300, 20);
        pane.add(lastUpdateText);
        
        // Init update progress bar
        JProgressBar updateProgressBar = new JProgressBar(0, 100);
        updateProgressBar.setValue(80);
        updateProgressBar.setBounds(270, 109, 190, 20);
        pane.add(updateProgressBar);
        
        // Init force update button
        JButton forceUpdateButton = new JButton("Force update");
        forceUpdateButton.setFont(new Font("Helvetica", Font.PLAIN, 12));
        forceUpdateButton.setBounds(470, 109, 100, 20);
        pane.add(forceUpdateButton);
        
        logModel.addElement("Loaded!");

        // Scroll down
        JScrollBar vertical = logScrollPane.getVerticalScrollBar();
        vertical.setValue(vertical.getMaximum());

        
        // Event listeners
        frame.addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent windowEvent){
               System.exit(0);
            }
        });
        
        //Display the window.
        frame.setVisible(true);
    }
}
